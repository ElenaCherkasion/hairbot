name: 🔍 Code Quality & Bot Health Checks

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    env:
      TELEGRAM_TOKEN: test_token_123
      NODE_ENV: test
      PORT: 3999
    
    steps:
      - name: 📥 Checkout code
        uses: actions/checkout@v4
      
      - name: ⎔ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: 📦 Install dependencies
        run: npm ci
      
      - name: 🧪 Import Test
        run: |
          echo "Testing imports..."
          node -e "
          try {
            require('fs').existsSync('./src/index.js') && console.log('src/index.js exists');
            console.log('✅ Basic check passed');
          } catch(e) {
            console.error('❌ Error:', e.message);
            process.exit(1);
          }
          "
      
      - name: 🚀 Quick Startup Test
        run: |
          echo "Quick bot test..."
          timeout 3s node index.js 2>&1 | head -20 || true
          echo "✅ Test completed"
