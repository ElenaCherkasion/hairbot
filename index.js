import dotenv from "dotenv";
dotenv.config();

import express from "express";
import fetch from "node-fetch";

// ================== –ö–û–ù–°–¢–ê–ù–¢–´ ==================
const –ü–û–†–¢ = process.env.PORT || 3000;
const –¢–û–ö–ï–ù_–¢–ï–õ–ï–ì–†–ê–ú = process.env.TELEGRAM_TOKEN; // üîπ –í–ê–® –¢–û–ö–ï–ù –ë–û–¢–ê
const –ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò = "cherkashina720@gmail.com"; // üîπ –í–ê–®–ê –ü–û–ß–¢–ê –ü–û–î–î–ï–†–ñ–ö–ò
const –í–ê–®_–î–û–ú–ï–ù = process.env.RENDER_EXTERNAL_HOSTNAME || `localhost:${–ü–û–†–¢}`;
const –°–°–´–õ–ö–ê_–ü–û–õ–ò–¢–ò–ö–ê = `https://${–í–ê–®_–î–û–ú–ï–ù}/privacy`;

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
if (!–¢–û–ö–ï–ù_–¢–ï–õ–ï–ì–†–ê–ú) {
  console.error("‚ùå –û–®–ò–ë–ö–ê: –¢–û–ö–ï–ù_–¢–ï–õ–ï–ì–†–ê–ú –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
  process.exit(1);
}

console.log("‚úÖ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...");

// ================== –¢–ï–°–¢–û–í–´–ï –¶–ï–ù–´ ==================
const –¢–ï–°–¢–û–í–´–ï_–¶–ï–ù–´ = {
  basic: 500,    // 5 —Ä—É–±–ª–µ–π
  pro: 1000,     // 10 —Ä—É–±–ª–µ–π
  premium: 1500  // 15 —Ä—É–±–ª–µ–π
};

function –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞(—Ç–∞—Ä–∏—Ñ) {
  const —Ü–µ–Ω–∞ = –¢–ï–°–¢–û–í–´–ï_–¶–ï–ù–´[—Ç–∞—Ä–∏—Ñ] || 0;
  return `${—Ü–µ–Ω–∞ / 100}‚ÇΩ`;
}

// ================== –°–û–°–¢–û–Ø–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ==================
const —Å–æ—Å—Ç–æ—è–Ω–∏–µ–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π = new Map();

// ================== TELEGRAM API ==================
const –ê–î–†–ï–°_–¢–ï–õ–ï–ì–†–ê–ú_–ê–ü–ò = `https://api.telegram.org/bot${–¢–û–ö–ï–ù_–¢–ï–õ–ï–ì–†–ê–ú}`;

async function –∑–∞–ø—Ä–æ—Å–¢–µ–ª–µ–≥—Ä–∞–º(–º–µ—Ç–æ–¥, –¥–∞–Ω–Ω—ã–µ) {
  try {
    const –æ—Ç–≤–µ—Ç = await fetch(`${–ê–î–†–ï–°_–¢–ï–õ–ï–ì–†–ê–ú_–ê–ü–ò}/${–º–µ—Ç–æ–¥}`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(–¥–∞–Ω–Ω—ã–µ),
      timeout: 30000
    });
    return await –æ—Ç–≤–µ—Ç.json();
  } catch (–æ—à–∏–±–∫–∞) {
    console.error(`‚ùå –û—à–∏–±–∫–∞ Telegram API (${–º–µ—Ç–æ–¥}):`, –æ—à–∏–±–∫–∞.message);
    return { ok: false, –æ–ø–∏—Å–∞–Ω–∏–µ: –æ—à–∏–±–∫–∞.message };
  }
}

async function –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, —Ç–µ–∫—Å—Ç, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ = null) {
  return –∑–∞–ø—Ä–æ—Å–¢–µ–ª–µ–≥—Ä–∞–º('sendMessage', {
    chat_id: ID—á–∞—Ç–∞,
    text: —Ç–µ–∫—Å—Ç,
    parse_mode: 'HTML',
    reply_markup: –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞,
    disable_web_page_preview: true
  });
}

async function –æ—Ç–≤–µ—Ç–∏—Ç—å–ù–∞Callback(ID–∫–æ–ª–±—ç–∫–∞, —Ç–µ–∫—Å—Ç = '') {
  return –∑–∞–ø—Ä–æ—Å–¢–µ–ª–µ–≥—Ä–∞–º('answerCallbackQuery', {
    callback_query_id: ID–∫–æ–ª–±—ç–∫–∞,
    text: —Ç–µ–∫—Å—Ç,
    show_alert: !!—Ç–µ–∫—Å—Ç
  });
}

// ================== –ö–õ–ê–í–ò–ê–¢–£–†–´ ==================
const –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã = {
  –æ—Å–Ω–æ–≤–Ω–∞—è: {
    inline_keyboard: [
      [{ text: "üìö –û —Å–µ—Ä–≤–∏—Å–µ HAIRbot", callback_data: "about" }],
      [{ text: "üìñ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–±–æ—Ä–æ–≤", callback_data: "examples" }],
      [{ text: "üéÅ –ë–ï–°–ü–õ–ê–¢–ù–´–ô –ê–ù–ê–õ–ò–ó", callback_data: "free" }],
      [{ text: `üíé BASIC - ${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('basic')} (—Ç–µ—Å—Ç)`, callback_data: "basic" }],
      [{ text: `‚ú® PRO - ${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('pro')} (—Ç–µ—Å—Ç)`, callback_data: "pro" }],
      [{ text: `üëë PREMIUM - ${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('premium')} (—Ç–µ—Å—Ç)`, callback_data: "premium" }],
      [
        { text: "üí∞ –°—Ä–∞–≤–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã", callback_data: "tariffs" },
        { text: "üîí –ü–æ–ª–∏—Ç–∏–∫–∞", url: –°–°–´–õ–ö–ê_–ü–û–õ–ò–¢–ò–ö–ê }
      ],
      [
        { text: "üìß –ü–æ–¥–¥–µ—Ä–∂–∫–∞", url: `mailto:${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}` },
        { text: "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data: "menu" }
      ]
    ]
  },
  
  –Ω–∞–∑–∞–¥: {
    inline_keyboard: [[{ text: "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data: "menu" }]]
  },
  
  —Å–æ–≥–ª–∞—Å–∏–µ: {
    inline_keyboard: [
      [{ text: "‚úÖ –°–æ–≥–ª–∞—Å–µ–Ω(–∞)", callback_data: "consent_yes" }],
      [{ text: "‚ùå –ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω(–∞)", callback_data: "consent_no" }]
    ]
  }
};

// ================== –¢–ï–ö–°–¢–´ –°–û–û–ë–©–ï–ù–ò–ô ==================
const –¢–µ–∫—Å—Ç—ã = {
  –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ: (—Ü–µ–Ω—ã) => `
üëã <b>–ü—Ä–∏–≤–µ—Ç! –Ø HAIRbot ‚Äî –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª–∏—Å—Ç!</b>

‚ú® <b>–ß—Ç–æ —è —É–º–µ—é:</b>
‚Ä¢ –û–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ñ–æ—Ä–º—É –≤–∞—à–µ–≥–æ –ª–∏—Ü–∞ –ø–æ —Ñ–æ—Ç–æ
‚Ä¢ –ü–æ–¥–±–∏—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∏–∂–∫–∏
‚Ä¢ –î–∞–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ü–≤–µ—Ç—É –≤–æ–ª–æ—Å
‚Ä¢ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

üéØ <b>–¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú</b>
–°–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω—ã –¥–µ–º–æ-—Ü–µ–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã:
‚Ä¢ BASIC: ${—Ü–µ–Ω—ã.basic}
‚Ä¢ PRO: ${—Ü–µ–Ω—ã.pro}
‚Ä¢ PREMIUM: ${—Ü–µ–Ω—ã.premium}

üî• <b>–ù–æ–≤–æ–µ:</b> –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞!

üîí <b>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</b> –í—Å–µ —Ñ–æ—Ç–æ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞.
–ü–æ–¥—Ä–æ–±–Ω–µ–µ: ${–°–°–´–õ–ö–ê_–ü–û–õ–ò–¢–ò–ö–ê}

üëá <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</b>`,

  –æ–°–µ—Ä–≤–∏—Å–µ: `
üìã <b>–û —Å–µ—Ä–≤–∏—Å–µ HAIRbot</b>

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—ã –ª–∏—Ü–∞ –∏ –ø–æ–¥–±–æ—Ä —Å—Ç—Ä–∏–∂–µ–∫.

üîπ <b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>
1. –í—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ñ–æ—Ç–æ –ª–∏—Ü–∞
2. –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º—É –∏ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏
3. –ü–æ–ª—É—á–∞–µ—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å—Ç—Ä–∏–∂–µ–∫
4. –°–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

üîí <b>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</b>
‚Ä¢ –§–æ—Ç–æ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞
‚Ä¢ –õ–∏—á–Ω–æ—Å—Ç—å –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è
‚Ä¢ –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è

üîó <b>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</b> ${–°–°–´–õ–ö–ê_–ü–û–õ–ò–¢–ò–ö–ê}

üìß <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b> ${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}`,

  —Ç–∞—Ä–∏—Ñ—ã: (—Ü–µ–Ω—ã) => `
üí∞ <b>–¢–∞—Ä–∏—Ñ—ã HAIRbot</b>

üéØ <b>–¢–ï–°–¢–û–í–´–ï –¶–ï–ù–´ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã)</b>

üéÅ <b>–ë–ï–°–ü–õ–ê–¢–ù–´–ô</b> (1 —Ä–∞–∑)
‚Ä¢ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –ª–∏—Ü–∞
‚Ä¢ 2 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
‚Ä¢ 2 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

üíé <b>BASIC - ${—Ü–µ–Ω—ã.basic}</b>
‚Ä¢ –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ª–∏—Ü–∞
‚Ä¢ 3 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å—Ç—Ä–∏–∂–µ–∫
‚Ä¢ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

‚ú® <b>PRO - ${—Ü–µ–Ω—ã.pro}</b>
‚Ä¢ –í—Å—ë –∏–∑ BASIC +
‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ü–≤–µ—Ç–æ—Ç–∏–ø–∞
‚Ä¢ 4 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —Ü–≤–µ—Ç–∞–º–∏
‚Ä¢ PDF-–æ—Ç—á–µ—Ç

üëë <b>PREMIUM - ${—Ü–µ–Ω—ã.premium}</b>
‚Ä¢ –í—Å—ë –∏–∑ PRO +
‚Ä¢ –£—á—ë—Ç —Ç–µ–∫—Å—Ç—É—Ä—ã –≤–æ–ª–æ—Å
‚Ä¢ 5 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

‚ö†Ô∏è <i>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–µ —Ü–µ–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞.</i>

üîó <b>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</b> ${–°–°–´–õ–ö–ê_–ü–û–õ–ò–¢–ò–ö–ê}

üìß <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b> ${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}`,

  –ø—Ä–∏–º–µ—Ä—ã: `
üìñ <b>–ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–±–æ—Ä–æ–≤</b>

–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç HAIRbot –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö:

üë© <b>–ü—Ä–∏–º–µ—Ä 1:</b> –û–≤–∞–ª—å–Ω–æ–µ –ª–∏—Ü–æ
‚Ä¢ –§–æ—Ä–º–∞: –æ–≤–∞–ª—å–Ω–∞—è
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –∫–∞—Å–∫–∞–¥, –¥–ª–∏–Ω–Ω—ã–π –±–æ–±
‚Ä¢ –¶–≤–µ—Ç: —Ö–æ–ª–æ–¥–Ω—ã–µ –∫–∞—à—Ç–∞–Ω–æ–≤—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏

üë© <b>–ü—Ä–∏–º–µ—Ä 2:</b> –ö—Ä—É–≥–ª–æ–µ –ª–∏—Ü–æ
‚Ä¢ –§–æ—Ä–º–∞: –∫—Ä—É–≥–ª–∞—è
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è —Å—Ç—Ä–∏–∂–∫–∞
‚Ä¢ –¶–≤–µ—Ç: –º–µ–¥–æ–≤—ã–µ –±–ª–∏–∫–∏

üë© <b>–ü—Ä–∏–º–µ—Ä 3:</b> –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –ª–∏—Ü–æ
‚Ä¢ –§–æ—Ä–º–∞: –∫–≤–∞–¥—Ä–∞—Ç–Ω–∞—è
‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏: –¥–ª–∏–Ω–Ω—ã–µ —Å–ª–æ–∏
‚Ä¢ –¶–≤–µ—Ç: —à–æ–∫–æ–ª–∞–¥–Ω—ã–π

üìß <b>–í–æ–ø—Ä–æ—Å—ã?</b> –ü–∏—à–∏—Ç–µ: ${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}`,

  –∑–∞–≥—Ä—É–∑–∫–∞–§–æ—Ç–æ: (—Ç–∞—Ä–∏—Ñ) => `
üéÅ <b>–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑</b>

üì∏ <b>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –ª–∏—Ü–∞:</b>
‚Ä¢ –õ–∏—Ü–æ –∞–Ω—Ñ–∞—Å
‚Ä¢ –•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
‚Ä¢ –ß—ë—Ç–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
‚Ä¢ –ë–µ–∑ –æ—á–∫–æ–≤/–≥–æ–ª–æ–≤–Ω—ã—Ö —É–±–æ—Ä–æ–≤

<i>–¢–∞—Ä–∏—Ñ: ${—Ç–∞—Ä–∏—Ñ.toUpperCase()}</i>`
};

// ================== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î ==================
async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–°—Ç–∞—Ä—Ç(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞) {
  const —Ü–µ–Ω—ã = {
    basic: –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('basic'),
    pro: –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('pro'),
    premium: –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('premium')
  };
  
  await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, –¢–µ–∫—Å—Ç—ã.–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ(—Ü–µ–Ω—ã), –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è);
}

async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–û—Å–µ—Ä–≤–∏—Å–µ(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞) {
  await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, –¢–µ–∫—Å—Ç—ã.–æ–°–µ—Ä–≤–∏—Å–µ, –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–Ω–∞–∑–∞–¥);
}

async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–¢–∞—Ä–∏—Ñ—ã(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞) {
  const —Ü–µ–Ω—ã = {
    basic: –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('basic'),
    pro: –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('pro'),
    premium: –ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('premium')
  };
  
  await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, –¢–µ–∫—Å—Ç—ã.—Ç–∞—Ä–∏—Ñ—ã(—Ü–µ–Ω—ã), –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è);
}

async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–ü—Ä–∏–º–µ—Ä—ã(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞) {
  await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, –¢–µ–∫—Å—Ç—ã.–ø—Ä–∏–º–µ—Ä—ã, –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–Ω–∞–∑–∞–¥);
}

async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–í—ã–±–æ—Ä–¢–∞—Ä–∏—Ñ–∞(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞, —Ç–∞—Ä–∏—Ñ) {
  if (—Ç–∞—Ä–∏—Ñ === 'free') {
    —Å–æ—Å—Ç–æ—è–Ω–∏–µ–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.set(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, { 
      mode: —Ç–∞—Ä–∏—Ñ, 
      awaitingPhoto: true,
      timestamp: Date.now()
    });
    
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, –¢–µ–∫—Å—Ç—ã.–∑–∞–≥—Ä—É–∑–∫–∞–§–æ—Ç–æ(—Ç–∞—Ä–∏—Ñ), –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–Ω–∞–∑–∞–¥);
  } else {
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞,
      `üí≥ <b>–û–ø–ª–∞—Ç–∞ —Ç–∞—Ä–∏—Ñ–∞ ${—Ç–∞—Ä–∏—Ñ.toUpperCase()}</b>\n\n` +
      `–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –æ–ø–ª–∞—Ç–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.\n` +
      `–°—É–º–º–∞: <b>${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞(—Ç–∞—Ä–∏—Ñ)}</b> (—Ç–µ—Å—Ç–æ–≤–∞—è —Ü–µ–Ω–∞)\n\n` +
      `üìß <b>–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:</b>\n` +
      `${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}`,
      –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–Ω–∞–∑–∞–¥
    );
  }
}

async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–§–æ—Ç–æ(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞, —Ñ–æ—Ç–æ) {
  const —Å–æ—Å—Ç–æ—è–Ω–∏–µ = —Å–æ—Å—Ç–æ—è–Ω–∏–µ–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.get(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è);
  
  if (!—Å–æ—Å—Ç–æ—è–Ω–∏–µ?.awaitingPhoto) {
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞,
      "üì∏ –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –≤ –º–µ–Ω—é.",
      –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è
    );
    return;
  }
  
  const —Ç–∞—Ä–∏—Ñ = —Å–æ—Å—Ç–æ—è–Ω–∏–µ.mode || 'free';
  
  // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è
  —Å–æ—Å—Ç–æ—è–Ω–∏–µ–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.delete(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è);
  
  await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞,
    `‚è≥ <b>–ù–∞—á–∏–Ω–∞—é –∞–Ω–∞–ª–∏–∑...</b>\n\n` +
    `–¢–∞—Ä–∏—Ñ: <b>${—Ç–∞—Ä–∏—Ñ.toUpperCase()}</b>\n` +
    `–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...`,
    –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–Ω–∞–∑–∞–¥
  );
  
  // –ò–º–∏—Ç–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
  setTimeout(async () => {
    await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞,
      `‚úÖ <b>–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω!</b>\n\n` +
      `–í —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –º–æ–¥—É–ª—å –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —É–ø—Ä–æ—â—ë–Ω–Ω–æ–º –≤–∏–¥–µ.\n\n` +
      `üìß <b>–í–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è?</b>\n` +
      `${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}`,
      –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è
    );
  }, 3000);
}

// ================== –û–ë–†–ê–ë–û–¢–ö–ê –û–ë–ù–û–í–õ–ï–ù–ò–ô ==================
async function –æ–±—Ä–∞–±–æ—Ç–∫–∞–û–±–Ω–æ–≤–ª–µ–Ω–∏—è(update) {
  try {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    if (update.message) {
      const ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = update.message.from.id;
      const ID—á–∞—Ç–∞ = update.message.chat.id;
      const —Ç–µ–∫—Å—Ç = update.message.text || '';

      if (—Ç–µ–∫—Å—Ç === '/start' || —Ç–µ–∫—Å—Ç === '/menu') {
        await –æ–±—Ä–∞–±–æ—Ç–∫–∞–°—Ç–∞—Ä—Ç(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞);
        return;
      }

      if (update.message.photo?.length > 0) {
        const —Ñ–æ—Ç–æ = update.message.photo[update.message.photo.length - 1];
        await –æ–±—Ä–∞–±–æ—Ç–∫–∞–§–æ—Ç–æ(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞, —Ñ–æ—Ç–æ);
        return;
      }

      if (—Ç–µ–∫—Å—Ç) {
        await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, "ü§ñ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ /start", –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è);
      }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ callback-–∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–Ω–æ–ø–æ–∫)
    if (update.callback_query) {
      const callback = update.callback_query;
      const ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = callback.from.id;
      const ID—á–∞—Ç–∞ = callback.message.chat.id;
      const –¥–∞–Ω–Ω—ã–µ = callback.data;

      await –æ—Ç–≤–µ—Ç–∏—Ç—å–ù–∞Callback(callback.id);

      switch(–¥–∞–Ω–Ω—ã–µ) {
        case 'menu':
          await –æ–±—Ä–∞–±–æ—Ç–∫–∞–°—Ç–∞—Ä—Ç(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞);
          break;
        case 'about':
          await –æ–±—Ä–∞–±–æ—Ç–∫–∞–û—Å–µ—Ä–≤–∏—Å–µ(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞);
          break;
        case 'tariffs':
          await –æ–±—Ä–∞–±–æ—Ç–∫–∞–¢–∞—Ä–∏—Ñ—ã(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞);
          break;
        case 'examples':
          await –æ–±—Ä–∞–±–æ—Ç–∫–∞–ü—Ä–∏–º–µ—Ä—ã(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞);
          break;
        case 'free':
        case 'basic':
        case 'pro':
        case 'premium':
          await –æ–±—Ä–∞–±–æ—Ç–∫–∞–í—ã–±–æ—Ä–¢–∞—Ä–∏—Ñ–∞(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, ID—á–∞—Ç–∞, –¥–∞–Ω–Ω—ã–µ);
          break;
        case 'consent_yes':
          await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, "‚úÖ –°–æ–≥–ª–∞—Å–∏–µ –ø–æ–ª—É—á–µ–Ω–æ!", –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è);
          break;
        case 'consent_no':
          await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, "‚ùå –°–æ–≥–ª–∞—Å–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ.", –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è);
          break;
        default:
          await –æ—Ç–ø—Ä–∞–≤–∏—Ç—å–°–æ–æ–±—â–µ–Ω–∏–µ(ID—á–∞—Ç–∞, "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞", –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã.–æ—Å–Ω–æ–≤–Ω–∞—è);
          break;
      }
    }
  } catch (–æ—à–∏–±–∫–∞) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', –æ—à–∏–±–∫–∞.message);
  }
}

// ================== EXPRESS APP ==================
const –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ = express();

// Middleware –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.use(express.json({ limit: "10mb" }));

// üîπ HEALTH CHECK –≠–ù–î–ü–û–ò–ù–¢
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.get("/health", (–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) => {
  –æ—Ç–≤–µ—Ç.status(200).json({ 
    status: "ok",
    service: "HAIRbot",
    timestamp: new Date().toISOString(),
    version: "1.0.0",
    test_mode: true,
    support_email: –ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò,
    privacy_policy: –°–°–´–õ–ö–ê_–ü–û–õ–ò–¢–ò–ö–ê
  });
});

// üîπ –ü–û–õ–ò–¢–ò–ö–ê –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–ò –≠–ù–î–ü–û–ò–ù–¢
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.get("/privacy", (–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) => {
  –æ—Ç–≤–µ—Ç.send(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ - HAIRbot</title>
      <meta charset="UTF-8">
      <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
        h1 { color: #333; text-align: center; }
        h2 { color: #444; margin-top: 30px; }
        .date { text-align: center; color: #666; font-style: italic; }
        .section { margin-bottom: 20px; }
        .contact { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .btn { display: inline-block; background: #0088cc; color: white; padding: 10px 20px; 
               text-decoration: none; border-radius: 5px; margin: 10px; }
      </style>
    </head>
    <body>
      <h1>üîí –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ HAIRbot</h1>
      <p class="date">–î–∞—Ç–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É: ${new Date().toLocaleDateString('ru-RU')}</p>
      
      <div class="section">
        <h2>1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è</h2>
        <p>–ù–∞—Å—Ç–æ—è—â–∞—è –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∑–∞—â–∏—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ HAIRbot (–¥–∞–ª–µ–µ ‚Äì "–ë–æ—Ç").</p>
      </div>
      
      <div class="section">
        <h2>2. –°–æ–±–∏—Ä–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
        <p>–ë–æ—Ç –º–æ–∂–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ:</p>
        <ul>
          <li>–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram</li>
          <li>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Telegram</li>
          <li>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ª–∏—Ü, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</li>
          <li>–ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º</li>
        </ul>
      </div>
      
      <div class="section">
        <h2>3. –¶–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h2>
        <p>–î–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è:</p>
        <ul>
          <li>–ê–Ω–∞–ª–∏–∑–∞ —Ñ–æ—Ä–º—ã –ª–∏—Ü–∞ –∏ –ø–æ–¥–±–æ—Ä–∞ —Å—Ç—Ä–∏–∂–µ–∫</li>
          <li>–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π</li>
          <li>–£–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —É—Å–ª—É–≥</li>
          <li>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
        </ul>
      </div>
      
      <div class="section">
        <h2>4. –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
        <p>–í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –ú—ã –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö.</p>
      </div>
      
      <div class="section">
        <h2>5. –¢—Ä–µ—Ç—å–∏ –ª–∏—Ü–∞</h2>
        <p>–ú—ã –Ω–µ –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–ª—É—á–∞–µ–≤, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –†–§.</p>
      </div>
      
      <div class="section">
        <h2>6. –í–∞—à–∏ –ø—Ä–∞–≤–∞</h2>
        <p>–í—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –Ω–∞ –¥–æ—Å—Ç—É–ø, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –î–ª—è —ç—Ç–æ–≥–æ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏.</p>
      </div>
      
      <div class="section contact">
        <h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
        <p>–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å:</p>
        <p>üìß Email: <a href="mailto:${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}">${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}</a></p>
        <p>Telegram: @HAIRbot_support</p>
      </div>
      
      <div style="text-align: center; margin-top: 30px;">
        <a href="/" class="btn">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        <a href="/health" class="btn">ü©∫ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</a>
      </div>
    </body>
    </html>
  `);
});

// üîπ –ì–õ–ê–í–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê –≠–ù–î–ü–û–ò–ù–¢
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.get("/", (–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) => {
  –æ—Ç–≤–µ—Ç.send(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>HAIRbot - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª–∏—Å—Ç</title>
      <meta charset="UTF-8">
      <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { text-align: center; }
        h1 { color: #333; }
        .status { color: green; font-weight: bold; }
        .btn { display: inline-block; background: #0088cc; color: white; padding: 10px 20px; 
               text-decoration: none; border-radius: 5px; margin: 10px; transition: background 0.3s; }
        .btn:hover { background: #006699; }
        .features { text-align: left; margin: 30px 0; padding: 20px; background: #f9f9f9; border-radius: 8px; }
        .price-list { display: flex; justify-content: center; gap: 20px; margin: 30px 0; }
        .price-card { border: 1px solid #ddd; border-radius: 8px; padding: 20px; min-width: 150px; }
        .price-card h3 { margin-top: 0; }
        .footer { margin-top: 40px; font-size: 0.9em; color: #666; }
      </style>
    </head>
    <body>
      <div class="container">
        <h1>ü§ñ HAIRbot</h1>
        <p class="status">‚úÖ –°–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ</p>
        
        <div class="features">
          <h3>‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:</h3>
          <ul>
            <li>–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—ã –ª–∏—Ü–∞ –ø–æ —Ñ–æ—Ç–æ</li>
            <li>–ü–æ–¥–±–æ—Ä –∏–¥–µ–∞–ª—å–Ω—ã—Ö —Å—Ç—Ä–∏–∂–µ–∫</li>
            <li>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ü–≤–µ—Ç—É –≤–æ–ª–æ—Å</li>
            <li>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>
          </ul>
        </div>
        
        <h3>üíé –¢–µ—Å—Ç–æ–≤—ã–µ —Ü–µ–Ω—ã:</h3>
        <div class="price-list">
          <div class="price-card">
            <h3>BASIC</h3>
            <p><strong>${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('basic')}</strong></p>
          </div>
          <div class="price-card">
            <h3>PRO</h3>
            <p><strong>${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('pro')}</strong></p>
          </div>
          <div class="price-card">
            <h3>PREMIUM</h3>
            <p><strong>${–ø–æ–ª—É—á–∏—Ç—å–¶–µ–Ω—É–î–ª—è–ü–æ–∫–∞–∑–∞('premium')}</strong></p>
          </div>
        </div>
        
        <p>üìß –ü–æ–¥–¥–µ—Ä–∂–∫–∞: <a href="mailto:${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}">${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}</a></p>
        
        <div>
          <a href="https://t.me/HAIRbot_test_bot" class="btn" target="_blank">üöÄ –ù–∞—á–∞—Ç—å –≤ Telegram</a>
          <a href="/privacy" class="btn">üîí –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
          <a href="/health" class="btn">ü©∫ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</a>
        </div>
        
        <div class="footer">
          <p>üîê –í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —É–¥–∞–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞</p>
          <p>¬© ${new Date().getFullYear()} HAIRbot. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
      </div>
    </body>
    </html>
  `);
});

// üîπ WEBHOOK –≠–ù–î–ü–û–ò–ù–¢
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.post("/webhook", async (–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) => {
  // –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ–º OK, —á—Ç–æ–±—ã Telegram –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª –∑–∞–ø—Ä–æ—Å
  –æ—Ç–≤–µ—Ç.status(200).send('OK');
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º update –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
  if (–∑–∞–ø—Ä–æ—Å.body && –∑–∞–ø—Ä–æ—Å.body.update_id) {
    try {
      await –æ–±—Ä–∞–±–æ—Ç–∫–∞–û–±–Ω–æ–≤–ª–µ–Ω–∏—è(–∑–∞–ø—Ä–æ—Å.body);
    } catch (–æ—à–∏–±–∫–∞) {
      console.error("‚ùå –û—à–∏–±–∫–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ webhook:", –æ—à–∏–±–∫–∞.message);
    }
  }
});

// üîπ –û–ë–†–ê–ë–û–¢–ö–ê 404
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.use((–∑–∞–ø—Ä–æ—Å, –æ—Ç–≤–µ—Ç) => {
  –æ—Ç–≤–µ—Ç.status(404).send(`
    <!DOCTYPE html>
    <html>
    <head><title>404 - –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</title></head>
    <body style="text-align: center; padding: 50px;">
      <h1>404 ü§∑‚Äç‚ôÇÔ∏è</h1>
      <p>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>
      <a href="/">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </body>
    </html>
  `);
});

// ================== –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê ==================
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.listen(–ü–û–†–¢, () => {
  console.log(`
üéâ HAIRbot –∑–∞–ø—É—â–µ–Ω!
üìç –ü–æ—Ä—Ç: ${–ü–û–†–¢}
üí∞ –†–µ–∂–∏–º: –¢–ï–°–¢–û–í–´–ô
üìß –ü–æ–¥–¥–µ—Ä–∂–∫–∞: ${–ü–û–ß–¢–ê_–ü–û–î–î–ï–†–ñ–ö–ò}
üåê –ì–ª–∞–≤–Ω–∞—è: http://localhost:${–ü–û–†–¢}/
üîí –ü–æ–ª–∏—Ç–∏–∫–∞: http://localhost:${–ü–û–†–¢}/privacy
ü©∫ Health: http://localhost:${–ü–û–†–¢}/health
üì® Webhook: http://localhost:${–ü–û–†–¢}/webhook
  `);
  
  // üîπ –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook:
  console.log(`
üöÄ –î–õ–Ø –ù–ê–°–¢–†–û–ô–ö–ò WEBHOOK –í–´–ü–û–õ–ù–ò–¢–ï –ö–û–ú–ê–ù–î–£:
curl -X POST "https://api.telegram.org/bot${–¢–û–ö–ï–ù_–¢–ï–õ–ï–ì–†–ê–ú}/setWebhook?url=https://hairstyle-bot.onrender.com/webhook"

üì± –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º–æ–π URL –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
https://api.telegram.org/bot${–¢–û–ö–ï–ù_–¢–ï–õ–ï–ì–†–ê–ú}/setWebhook?url=https://hairstyle-bot.onrender.com/webhook
  `);
});

// ================== –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö ==================
process.on('uncaughtException', (–æ—à–∏–±–∫–∞) => {
  console.error('‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞:', –æ—à–∏–±–∫–∞.message);
  console.error('Stack:', –æ—à–∏–±–∫–∞.stack);
});

process.on('unhandledRejection', (–ø—Ä–∏—á–∏–Ω–∞, –ø—Ä–æ–º–∏—Å) => {
  console.error('‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –ø—Ä–æ–º–∏—Å:', –ø—Ä–∏—á–∏–Ω–∞);
});

// ================== –û–ß–ò–°–¢–ö–ê –°–û–°–¢–û–Ø–ù–ò–Ø (—Ä–∞–∑ –≤ —á–∞—Å) ==================
setInterval(() => {
  const —Å–µ–π—á–∞—Å = Date.now();
  let —É–¥–∞–ª–µ–Ω–æ = 0;
  
  for (const [ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ] of —Å–æ—Å—Ç–æ—è–Ω–∏–µ–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.entries()) {
    if (—Å–µ–π—á–∞—Å - —Å–æ—Å—Ç–æ—è–Ω–∏–µ.timestamp > 3600000) { // 1 —á–∞—Å
      —Å–æ—Å—Ç–æ—è–Ω–∏–µ–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.delete(ID–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è);
      —É–¥–∞–ª–µ–Ω–æ++;
    }
  }
  
  if (—É–¥–∞–ª–µ–Ω–æ > 0) {
    console.log(`üßπ –û—á–∏—â–µ–Ω–æ ${—É–¥–∞–ª–µ–Ω–æ} —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
  }
}, 3600000); // –ö–∞–∂–¥—ã–π —á–∞—Å
